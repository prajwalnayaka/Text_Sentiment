{% extends "layout.html" %}

{% block content %}
<div class="row justify-content-center text-margin-space">
    <div class="col-md-6">

        <div class="card p-4 mb-4 rounded-5 shadow-lg card-bg text-white">
            <h2 class="mb-3">How are you feeling?</h2>
            <textarea id="userText" class="form-control mb-3" rows="4" placeholder="Type what you feel :)"></textarea>
            <button onclick="predictEmotion()" class="btn btn-primary btn-lg w-100">Analyze Emotion</button>
        </div>

        <div id="resultCard" class="card p-4 text-center d-none">
            <h4 class="text-muted">Detected Emotion:</h4>

            <div id="emojiDisplay" class="emoji-large mb-2">ğŸ¤”</div>
            <h1 id="emotionLabel" class="display-4 fw-bold text-primary">...</h1>

            <hr>
            <p class="text-muted small">
                Inference Time: <span id="timeLabel">0.00</span>s
            </p>
        </div>

    </div>
</div>

<script>
    // Emoji Mapping for visual flair
    const emojiMap = {
        'happiness': 'ğŸ˜„', 'sadness': 'ğŸ˜¢', 'anger': 'ğŸ˜¡',
        'fear': 'ğŸ˜±', 'love': 'ğŸ˜', 'surprise': 'ğŸ˜²',
        'neutral': 'ğŸ˜', 'fun': 'ğŸ¥³', 'enthusiasm': 'ğŸ¤©',
        'empty': 'ğŸ˜¶', 'worry': 'ğŸ˜Ÿ', 'hate': 'ğŸ¤¬', 'relief': 'ğŸ˜Œ'
    };

    async function predictEmotion() {
        const text = document.getElementById("userText").value;
        const resultCard = document.getElementById("resultCard");

        if (!text) return alert("Please enter some text!");

        // Send data to Flask
        const response = await fetch('/accept', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: text })
        });

        const data = await response.json();

        // Update UI
        resultCard.classList.remove("d-none"); // Show the card
        document.getElementById("emotionLabel").innerText = data.emotion.toUpperCase();
        document.getElementById("timeLabel").innerText = data.total_time;

        // Set Emoji
        const emoji = emojiMap[data.emotion] || 'ğŸ¤–';
        document.getElementById("emojiDisplay").innerText = emoji;
    }
</script>
{% endblock %}